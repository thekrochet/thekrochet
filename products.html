

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Products | TheKrochet</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">

<link rel="stylesheet" href="brand.css">
<link rel="stylesheet" href="responsive.css">

<style>
:root{
  --bg:#faf7f2; --text:#2f2f2f; --card:#ffffff; --nav:#ffffff;
  --shadow:rgba(0,0,0,0.08); --primary:#d4a373; --primary-dark:#b8895b;
  
  /* SUPER SMOOTH CUSTOM EASINGS */
  --ease-spring: cubic-bezier(0.4, 0.0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
}

body.dark{
  --bg:#121212; --text:#f1f1f1; --card:#1e1e1e; --nav:#1a1a1a;
  --shadow:rgba(0,0,0,0.6);
}

*{margin:0;padding:0;box-sizing:border-box}
html { scroll-behavior: smooth; }

body{
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  display:flex;
  flex-direction:column;
  transition: background 0.5s var(--ease-spring);
}

/* ===== SEARCH ANIMATION ===== */
.search-box{
  max-width:460px;
  margin:26px auto 0;
  padding:0 16px;
  perspective: 1000px;
}
.search-box input{
  width:100%;
  padding:15px 24px;
  border-radius:50px;
  border:2px solid transparent;
  background:var(--card);
  color:var(--text);
  box-shadow: 0 4px 15px var(--shadow);
  transition: all 0.4s var(--ease-spring);
  outline: none;
  transform-origin: center;
}
.search-box:hover input{
  transform: translateY(-2px) scale(1.01);
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}
.search-box input:focus{
  border-color: var(--primary);
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 15px 35px rgba(212, 163, 115, 0.25);
}

/* ===== PRODUCTS ===== */
.products-section{
  max-width:1200px;
  margin:auto;
  padding:34px 20px 90px;
  flex:1;
}
#products{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:30px;
}

/* ===== CARD STYLES ===== */
.card{
  background:var(--card);
  padding:16px;
  border-radius:26px;
  box-shadow:0 10px 20px var(--shadow);
  display:flex;
  flex-direction:column;
  overflow: hidden;
  position: relative;
  opacity: 0;
  transform: translateY(40px);
  animation: cardEntrance 0.8s var(--ease-spring) forwards;
  transition: transform 0.4s var(--ease-spring), box-shadow 0.4s var(--ease-spring);
}
@keyframes cardEntrance { to { opacity: 1; transform: translateY(0); } }

.card:hover{
  transform: translateY(-12px);
  box-shadow: 0 25px 50px rgba(0,0,0,0.15);
}

/* --- PRODUCT CARD SLIDER --- */
.img-window {
  width: 100%;
  height: 230px;
  border-radius: 20px;
  overflow: hidden;
  cursor: pointer;
  position: relative;
}

.img-slider {
  display: flex;
  height: 100%;
  width: 100%;
  transition: transform 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
}

.img-slider img {
  min-width: 100%;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.6s var(--ease-spring);
}
.card:hover .img-slider img{ transform: scale(1.05); }

/* --- TEXT & BUTTONS --- */
.card h3{
  margin-top:16px;
  font-size:17px;
  font-weight: 600;
  transition: color 0.3s ease;
}
.card:hover h3{ color: var(--primary-dark); }

.price{
  color:var(--primary-dark);
  font-weight:700;
  margin:6px 0;
  font-size: 1.15em;
}
.card p{
  font-size:13px;
  opacity:.75;
  margin-bottom: 14px;
  line-height: 1.5;
}

.card button{
  margin-top:auto;
  padding:14px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;
  font-weight:600;
  cursor:pointer;
  box-shadow: 0 4px 15px rgba(212, 163, 115, 0.4);
  transition: all 0.3s var(--ease-bounce);
  transform: scale(1);
}
.card button:hover{
  box-shadow: 0 8px 25px rgba(212, 163, 115, 0.6);
  transform: scale(1.05);
}
.card button:active{ transform: scale(0.95); }

/* ===== CART FLOAT ===== */
.cart-float{
  position:fixed;
  right:20px;
  bottom:30px;
  background:var(--primary);
  color:#fff;
  padding:16px 26px;
  border-radius:50px;
  cursor:pointer;
  z-index:999;
  font-weight: 600;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
  transition: all 0.3s var(--ease-spring);
  animation: floaty 4s ease-in-out infinite;
}
.cart-float:hover{ background: var(--primary-dark); transform: scale(1.1); }
.cart-float:active{ transform: scale(0.95); }

@keyframes floaty {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}
.cart-bump { animation: bump 0.4s var(--ease-bounce); }
@keyframes bump {
  0% { transform: scale(1); }
  50% { transform: scale(1.25); }
  100% { transform: scale(1); }
}

/* ===== MODALS ===== */
.modal{
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:1000;
  background:rgba(0,0,0,0); backdrop-filter: blur(0px); opacity: 0; visibility: hidden; pointer-events: none;
  transition: opacity 0.4s ease, backdrop-filter 0.4s ease, visibility 0.4s;
}
.modal.active{
  background:rgba(0,0,0,0.6); backdrop-filter: blur(8px); opacity: 1; visibility: visible; pointer-events: auto;
}
.modal-box{
  background:var(--card); width:90%; max-width:420px; padding:26px; border-radius:30px;
  box-shadow: 0 50px 100px -20px rgba(0,0,0,0.3); opacity: 0; transform: scale(0.8) translateY(20px);
  transition: all 0.5s var(--ease-bounce); 
}
.modal.active .modal-box{ opacity: 1; transform: scale(1) translateY(0); }

/* --- POPUP IMAGE SLIDER --- */
#imgModal .modal-box{
  max-width:600px; 
  height: 70vh; /* Fixed height for slideshow */
  width: 90%;
  background:transparent; 
  box-shadow:none; 
  padding: 0; 
  overflow: hidden; /* Hide scrollbars */
  position: relative;
  transform: scale(0.9);
}
#imgModal.active .modal-box{ transform: scale(1); }

.popup-slider {
  display: flex;
  height: 100%;
  width: 100%;
  transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); /* Smooth slide ease */
}

.popup-slider img {
  min-width: 100%;
  width: 100%;
  height: 100%;
  object-fit: contain; /* Shows full image */
  border-radius: 24px;
  /* Optional: shadow inside image */
  filter: drop-shadow(0 20px 40px rgba(0,0,0,0.5));
}
/* -------------------------------- */

.modal-box h3{ text-align:center; margin-bottom:18px; font-size:1.4rem; }
.form-group{margin-bottom:16px}
.form-group label{
  font-size:13px; font-weight:600; display:block; margin-bottom:6px; color:var(--primary-dark);
}
.modal-box input{
  width:100%; padding:14px; border-radius:14px;
  border:1px solid #eee; background:var(--bg); color:var(--text);
  transition: 0.3s var(--ease-spring); outline:none;
}
.modal-box input:focus{
  border-color: var(--primary); background: var(--card); box-shadow: 0 0 0 4px rgba(212, 163, 115, 0.15);
}
.cart-item{ display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid #eee; align-items:center; }
.modal-actions{ display:flex; gap:12px; margin-top:20px; }
.modal-actions button{
  flex:1; padding:14px; border-radius:16px; border:none; cursor:pointer; font-size:14px; transition: 0.3s var(--ease-spring);
}
.modal-actions button:active{ transform: scale(0.95); }
.cancel{ background:#eee; color:#555; font-weight:500; }
.cancel:hover{ background:#ddd; }
.primary{
  background:linear-gradient(135deg,var(--primary),var(--primary-dark)); color:#fff; font-weight:600;
  box-shadow: 0 4px 15px rgba(212, 163, 115, 0.4);
}
.primary:hover{ 
  box-shadow: 0 8px 25px rgba(212, 163, 115, 0.5); transform:translateY(-2px); 
}
</style>
</head>

<body>

<nav data-aos="fade-down">
  <div class="nav-top">
    <h2>TheKrochet</h2>
  </div>
  <div class="nav-links">
    <a href="index.html">Home</a>
    <a href="products.html" class="active">Products</a>
    <a href="reviews.html">Reviews</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </div>
</nav>

<div class="search-box">
  <input id="searchInput" placeholder="Search products...">
</div>

<div class="products-section">
  <div id="products"></div>
</div>

<div id="cartFloat" class="cart-float" onclick="openCart()">ðŸ›’ Cart (<span id="cartCount">0</span>)</div>

<div id="cartModal" class="modal">
  <div class="modal-box">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <div style="text-align:right;font-weight:bold;margin-top:15px;font-size:1.1rem;color:var(--primary-dark)">
      Total â‚¹<span id="totalPrice">0</span>
    </div>
    <div class="modal-actions">
      <button class="cancel" onclick="closeCart()">Cancel</button>
      <button class="primary" onclick="openOrderForm()">Continue</button>
    </div>
  </div>
</div>

<div id="orderModal" class="modal">
  <div class="modal-box">
    <h3>Complete Order</h3>
    <div class="form-group">
      <label>Your Name</label>
      <input id="custName" placeholder="Enter your name">
    </div>
    <div class="form-group">
      <label>Instagram Username</label>
      <input id="custInsta" placeholder="@yourusername">
    </div>
    <div class="modal-actions">
      <button class="cancel" onclick="closeOrder()">Back</button>
      <button class="primary" onclick="submitOrder()">Send on Instagram</button>
    </div>
  </div>
</div>

<div id="imgModal" class="modal" onclick="closeImg(event)">
  <div class="modal-box" id="imgBox">
    </div>
</div>

<footer>Â© 2025 TheKrochet</footer>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

<script>
AOS.init({duration:900,once:true});
if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");

/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyAbFV0WbIVMpibxnIiVbwtnOqtvJ6ts_sY",
  authDomain:"thekrochet-b3ca2.firebaseapp.com",
  projectId:"thekrochet-b3ca2"
});
const db=firebase.firestore();

/* ELEMENTS */
const productsDiv=document.getElementById("products");
const cartItems=document.getElementById("cartItems");
const cartCount=document.getElementById("cartCount");
const cartFloat=document.getElementById("cartFloat");
const totalPrice=document.getElementById("totalPrice");
const cartModal=document.getElementById("cartModal");
const orderModal=document.getElementById("orderModal");
const searchInput=document.getElementById("searchInput");
const imgModal=document.getElementById("imgModal");
const imgBox=document.getElementById("imgBox");

let cart=JSON.parse(localStorage.getItem("krochetCart"))||[];

/* LOAD PRODUCTS (UPDATED TO FIX COMMA IMAGES) */
db.collection("products").orderBy("createdAt","desc").onSnapshot(snap=>{
  productsDiv.innerHTML="";
  let index = 0; 
  
  snap.forEach(doc=>{
    const p=doc.data();
    
    // âœ… AUTO-DETECT COMMA SEPARATED LINKS
    let imgs = p.images;
    if (!imgs) {
      // If 'images' array doesn't exist, check single 'image' string
      if (p.image && typeof p.image === 'string' && p.image.includes(",")) {
        // Split by comma and remove spaces
        imgs = p.image.split(",").map(url => url.trim());
      } else {
        // Just a single image
        imgs = [p.image];
      }
    }

    const sid="s"+Math.random().toString(36).slice(2);
    let i=0;

    // Create all img tags for the slider (Card View)
    const imgHtml = imgs.map(url => `<img src="${url}">`).join('');

    productsDiv.innerHTML+=`
      <div class="card" style="animation-delay: ${index * 80}ms">
        <div class="img-window" onclick='openImg(${JSON.stringify(imgs)})'>
            <div id="${sid}" class="img-slider">
                ${imgHtml}
            </div>
        </div>
        <h3>${p.name}</h3>
        <div class="price">â‚¹${p.price}</div>
        <p>${p.description||""}</p>
        <button onclick="addToCart('${p.name}',${p.price})">Add to Cart</button>
      </div>`;
      
    index++; 

    // AUTO SCROLL LOGIC FOR CARDS
    setInterval(()=>{
      if(document.querySelector(".modal.active")) return;
      if(imgs.length>1){
        i=(i+1)%imgs.length;
        const slider=document.getElementById(sid);
        if(!slider) return;
        slider.style.transform=`translateX(-${i * 100}%)`;
      }
    },2500); 
  });
});

/* --- POPUP SLIDESHOW LOGIC --- */
let popupTimer;

function openImg(imgs){
  let i = 0;
  
  // Build the slider structure inside the popup
  const slides = imgs.map(src => `<img src="${src}">`).join('');
  imgBox.innerHTML = `
    <div class="popup-slider" id="activePopupSlider">
        ${slides}
    </div>
  `;
  
  imgModal.classList.add("active");
  
  // Start the auto-scroll for the popup
  popupTimer = setInterval(()=>{
    if(imgs.length > 1){
      i = (i + 1) % imgs.length;
      const slider = document.getElementById("activePopupSlider");
      if(slider){
        slider.style.transform = `translateX(-${i * 100}%)`;
      }
    }
  }, 2000); // 2 seconds per slide in popup
}

function closeImg(e){
  // Check if clicked strictly on the background (id=imgModal)
  if(e.target.id==="imgModal"){
    imgModal.classList.remove("active");
    clearInterval(popupTimer);
  }
}

/* SEARCH */
searchInput.addEventListener("input",()=>{
  const v=searchInput.value.toLowerCase();
  document.querySelectorAll(".card").forEach(c=>{
    if(c.innerText.toLowerCase().includes(v)){
      c.style.display="flex";
      c.style.animation = 'none';
      c.offsetHeight; 
      c.style.animation = 'cardEntrance 0.5s var(--ease-spring) forwards';
    } else {
      c.style.display="none";
    }
  });
});

/* CART */
function addToCart(name,price){
  cart.push({name,price});
  localStorage.setItem("krochetCart",JSON.stringify(cart));
  
  cartFloat.classList.remove("cart-bump");
  void cartFloat.offsetWidth; 
  cartFloat.classList.add("cart-bump");
  
  updateCart();
}
function updateCart(){
  cartItems.innerHTML="";
  let total=0;
  cart.forEach((p,i)=>{
    total+=p.price;
    cartItems.innerHTML+=`
      <div class="cart-item">
        <span>${p.name}</span>
        <span>â‚¹${p.price} <b style="cursor:pointer;color:red;padding:5px;" onclick="removeItem(${i})">âœ–</b></span>
      </div>`;
  });
  cartCount.innerText=cart.length;
  totalPrice.innerText=total;
}
function removeItem(i){
  cart.splice(i,1);
  localStorage.setItem("krochetCart",JSON.stringify(cart));
  updateCart();
}
function openCart(){cartModal.classList.add("active")}
function closeCart(){cartModal.classList.remove("active")}
function openOrderForm(){closeCart();orderModal.classList.add("active")}
function closeOrder(){orderModal.classList.remove("active")}

/* SUBMIT ORDER */
function submitOrder(){
  const name=custName.value.trim();
  const insta=custInsta.value.trim();
  if(!name||!insta) return;

  let total=0;
  let msg="Hello, I want to order:\n";
  cart.forEach(p=>{ total+=p.price; msg+=`- ${p.name}: â‚¹${p.price}\n`; });
  msg+=`\nTotal: â‚¹${total}\nName: ${name}\nInstagram: ${insta}`;

  // âœ… FIXED: Sending data Flat so Admin Panel can read it!
  db.collection("orders").add({
    customerName: name,  // Correct key for admin
    instagram: insta,    // Correct key for admin
    items: cart,
    total: total,
    status: "Pending",   // Standardized status
    source: "website",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  navigator.clipboard.writeText(msg).catch(()=>{});
  cart=[]; localStorage.removeItem("krochetCart");
  updateCart(); closeOrder();
  setTimeout(()=>{ window.location.href="https://ig.me/m/thekrochet_"; },300);
}
updateCart();
</script>

</body>
</html>

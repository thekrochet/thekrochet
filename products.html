<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Products | TheKrochet</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">

<link rel="stylesheet" href="brand.css">
<link rel="stylesheet" href="responsive.css">

<style>
/* PAGE SPECIFIC STYLES */
:root{ --bg:#faf7f2; --text:#2f2f2f; --card:#ffffff; --nav:#ffffff; --shadow:rgba(0,0,0,0.08); --primary:#d4a373; --primary-dark:#b8895b; --success:#27ae60; --gray:#e0e0e0; --ease-spring: cubic-bezier(0.4, 0.0, 0.2, 1); }
body.dark{ --bg:#121212; --text:#f1f1f1; --card:#1e1e1e; --nav:#1a1a1a; --shadow:rgba(0,0,0,0.6); --gray:#333; }
*{margin:0;padding:0;box-sizing:border-box} html { scroll-behavior: smooth; }
body{ font-family:'Poppins',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; display:flex; flex-direction:column; overflow-x: hidden; transition: background 0.5s var(--ease-spring); }

nav { position: sticky; top: 0; z-index: 100; background: var(--nav); backdrop-filter: blur(10px); padding: 10px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 8px; }
.nav-line-1 { position: relative; width: 100%; display: flex; justify-content: center; align-items: center; padding: 0 15px; }
.nav-logo { font-family: 'Playfair Display', serif; font-size: 1.8rem; color: var(--text); text-decoration: none; font-weight: 700; }
/* Profile Button triggers profile.js */
#userBtn { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); width: 38px; height: 38px; border-radius: 50%; border: 1px solid var(--primary); color: var(--primary); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; z-index: 101; }
#userBtn:hover { background: var(--primary); color: #fff; }
.nav-line-2 { display: flex; justify-content: center; gap: 20px; }
.nav-links a { text-decoration: none; color: var(--text); font-weight: 500; font-size: 0.9rem; opacity: 0.7; transition: 0.3s; position: relative; padding-bottom: 2px; }
.nav-links a.active, .nav-links a:hover { opacity: 1; color: var(--primary); }
.nav-links a::after { content: ''; position: absolute; width: 0; height: 2px; bottom: 0; left: 0; background: var(--primary); transition: 0.3s; }
.nav-links a:hover::after, .nav-links a.active::after { width: 100%; }

.search-box{ max-width:460px; margin:20px auto 0; padding:0 16px; }
.search-box input{ width:100%; padding:14px 24px; border-radius:50px; border:2px solid transparent; background:var(--card); color:var(--text); box-shadow: 0 4px 15px var(--shadow); outline: none; transition: 0.3s; }
.search-box input:focus{ border-color: var(--primary); }
.products-section{ max-width:1200px; margin:auto; padding:20px 20px 80px; }
#products{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:25px; }

/* 3D TILT CARD STYLES */
.card{ 
  background:var(--card); padding:15px; border-radius:24px; box-shadow:0 10px 20px var(--shadow); 
  display:flex; flex-direction:column; overflow: visible; 
  animation: fadeUp 0.6s ease forwards;
  transform-style: preserve-3d; transform: perspective(1000px); will-change: transform;
}
@keyframes fadeUp { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }

.img-window { 
  width: 100%; height: 230px; border-radius: 20px; overflow: hidden; cursor: pointer; position: relative; margin-bottom: 15px; 
  transform: translateZ(20px); box-shadow: 0 15px 35px rgba(0,0,0,0.1); transition: all 0.2s ease;
}
.img-slider { display: flex; height: 100%; width: 100%; transition: transform 0.8s cubic-bezier(0.4, 0.0, 0.2, 1); }
.img-slider img { min-width: 100%; width: 100%; height: 100%; object-fit: cover; }

/* 3D Text Pop Effect */
.card h3, .card .price, .card p, .card button { transform: translateZ(10px); }
.card h3{ margin-top:5px; font-size:1.1rem; font-weight: 600; color: var(--text); }
.price{ color:var(--primary-dark); font-weight:700; font-size: 1.1rem; margin-bottom: 8px; }
.card p{ font-size: 0.85rem; opacity: 0.75; margin-bottom: 15px; line-height: 1.4; }
.card button{ margin-top:auto; padding:12px; border:none; border-radius:18px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color:#fff; font-weight:600; cursor:pointer; width: 100%; box-shadow: 0 4px 15px rgba(212, 163, 115, 0.4); }

.cart-float{ position:fixed; right:20px; bottom:30px; background:var(--primary); color:#fff; padding:16px 26px; border-radius:50px; cursor:pointer; z-index:999; font-weight: 600; box-shadow:0 10px 30px rgba(0,0,0,.3); animation: floaty 4s ease-in-out infinite; }
@keyframes floaty { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
.pay-apps-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
#imgModal .modal-box { max-width: 600px; width: 95%; background: transparent; box-shadow: none; padding: 0; overflow: hidden; }
.popup-slider { display: flex; width: 100%; transition: transform 0.5s ease; }
.popup-slider img { min-width: 100%; width: 100%; border-radius: 15px; object-fit: contain; max-height: 80vh; }
</style>
</head>

<body>

<nav data-aos="fade-down">
  <div class="nav-line-1">
    <a href="index.html" class="nav-logo">TheKrochet</a>
    <div id="userBtn" onclick="handleProfileClick()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
    </div>
  </div>
  <div class="nav-line-2 nav-links">
    <a href="index.html">Home</a>
    <a href="products.html" class="active">Products</a>
    <a href="reviews.html">Reviews</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </div>
</nav>

<div class="search-box"><input id="searchInput" placeholder="Search products..."></div>
<div class="products-section"><div id="products"></div></div>
<div id="cartFloat" class="cart-float" onclick="openCart()">ðŸ›’ Cart (<span id="cartCount">0</span>)</div>

<div id="cartModal" class="modal">
  <div class="modal-box">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <div style="text-align:right;font-weight:bold;margin-top:15px;color:var(--primary-dark)">Total â‚¹<span id="totalPrice">0</span></div>
    <div style="display:flex;gap:10px;margin-top:20px;">
      <button style="flex:1;padding:12px;border:none;border-radius:12px;background:#eee;color:#555;" onclick="closeModal('cartModal')">Close</button>
      <button style="flex:1;padding:12px;border:none;border-radius:12px;background:var(--primary);color:#fff;font-weight:600;" onclick="checkLoginForOrder()">Continue</button>
    </div>
  </div>
</div>

<div id="orderModal" class="modal">
  <div class="modal-box">
    <h3>Shipping Details</h3>
    <input id="custName" placeholder="Full Name">
    <input id="custInsta" placeholder="Instagram Username (@user)">
    <textarea id="custAddress" rows="3" placeholder="Full Delivery Address (Street, City, Pincode)"></textarea>
    <div style="display:flex;gap:10px;margin-top:20px;">
      <button style="flex:1;padding:12px;border-radius:12px;border:none;background:#eee;color:#555;" onclick="closeModal('orderModal')">Back</button>
      <button style="flex:1;padding:12px;border-radius:12px;border:none;background:var(--primary);color:#fff;font-weight:600;" onclick="openPaymentModal()">Proceed to Pay</button>
    </div>
  </div>
</div>

<div id="paymentAppModal" class="modal">
  <div class="modal-box">
    <h3>Select Payment App</h3>
    <p style="text-align:center;font-size:1rem;font-weight:600;margin-bottom:20px;">Pay â‚¹<span id="payAmountDisplay">0</span></p>
    <div class="pay-apps-grid">
      <div class="pay-app-btn" onclick="launchUPI('gpay')">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Google_Pay_Logo.svg/512px-Google_Pay_Logo.svg.png" alt="Google Pay" class="pay-app-img">
        <span class="pay-app-name">Google Pay</span>
      </div>
      <div class="pay-app-btn" onclick="launchUPI('paytm')">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Paytm_Logo_%28standalone%29.svg/512px-Paytm_Logo_%28standalone%29.svg.png" alt="Paytm" class="pay-app-img">
        <span class="pay-app-name">Paytm</span>
      </div>
      <div class="pay-app-btn" onclick="launchUPI('phonepe')">
        <img src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/phonepe-logo-icon.png" alt="PhonePe" class="pay-app-img">
        <span class="pay-app-name">PhonePe</span>
      </div>
      <div class="pay-app-btn" onclick="showQR()">
        <img src="https://cdn-icons-png.flaticon.com/512/3502/3502601.png" alt="QR Code" class="pay-app-img" style="filter:none;">
        <span class="pay-app-name">Scan QR</span>
      </div>
    </div>
    <button style="width:100%;padding:12px;border:none;background:transparent;color:var(--text);opacity:0.6;margin-top:15px;cursor:pointer;font-weight:500;" onclick="closeModal('paymentAppModal')">Cancel</button>
  </div>
</div>

<div id="qrModal" class="modal">
  <div class="modal-box" style="text-align:center;">
    <h3>Scan to Pay</h3>
    <p style="margin-bottom:10px;">Scan with any UPI App</p>
    <div class="qr-container">
      <img id="dynamicQR" class="qr-img" src="" alt="Loading QR...">
    </div>
    <div style="font-weight:bold; font-size:1.2rem; color:var(--primary-dark); margin-bottom:20px;">â‚¹<span id="qrAmount">0</span></div>
    <button class="confirm-btn" onclick="confirmAndFinishOrder()">Paid?</button>
    <button style="width:100%;padding:12px;border:none;background:transparent;color:var(--text);opacity:0.6;margin-top:5px;cursor:pointer;" onclick="closeModal('qrModal')">Cancel</button>
  </div>
</div>

<div id="confirmCheckModal" class="modal">
  <div class="modal-box" style="text-align:center;">
    <h3 style="margin-bottom:10px;">Payment Pending</h3>
    <p>We've opened your payment app.<br>Please complete the transaction there.</p>
    <button class="confirm-btn" onclick="confirmAndFinishOrder()">Paid?</button>
    <button style="width:100%;padding:12px;border:none;background:transparent;color:var(--text);opacity:0.6;margin-top:5px;cursor:pointer;font-weight:500;" onclick="closeModal('confirmCheckModal')">Cancel / Retry</button>
  </div>
</div>

<div id="orderSuccessModal" class="modal">
  <div class="modal-box" style="text-align:center; padding: 40px 30px;">
    <div class="success-icon">ðŸŽ‰</div>
    <h3 style="margin-bottom:10px; color: var(--success);">Order Confirmed!</h3>
    <p>Thank you for your purchase.<br>Your order has been placed successfully.</p>
    <button class="confirm-btn" onclick="finishOrderFlow()">Continue Shopping</button>
  </div>
</div>

<div id="imgModal" class="modal" onclick="closeImg(event)"><div class="modal-box" id="imgBox"></div></div>

<footer>Â© 2025 TheKrochet</footer>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

<script>
AOS.init({duration:900,once:true});
if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");

const myUPI = "6351294436@ptaxis"; 
const myName = "TheKrochet";

firebase.initializeApp({
  apiKey:"AIzaSyAbFV0WbIVMpibxnIiVbwtnOqtvJ6ts_sY",
  authDomain:"thekrochet-b3ca2.firebaseapp.com",
  projectId:"thekrochet-b3ca2"
});
const db = firebase.firestore();

let cart = JSON.parse(localStorage.getItem("krochetCart")) || [];
let currentTotal = 0;
let popupInterval = null;

/* 3D TILT LOGIC */
function initTilt() {
  const cards = document.querySelectorAll('.card');
  cards.forEach(card => {
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const rotateX = ((y - centerY) / centerY) * -10;
      const rotateY = ((x - centerX) / centerX) * 10;
      card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05)`;
    });
    card.addEventListener('mouseleave', () => {
      card.style.transform = `perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)`;
    });
  });
}

/* PRODUCTS LOGIC */
const productsDiv = document.getElementById("products");
db.collection("products").orderBy("createdAt","desc").onSnapshot(snap=>{
  productsDiv.innerHTML="";
  snap.forEach((doc, idx)=>{
    const p=doc.data();
    let imgs = p.images || (p.image && p.image.includes(",") ? p.image.split(",").map(u=>u.trim()) : [p.image]);
    const sid="s"+Math.random().toString(36).slice(2);
    const imgHtml = imgs.map(url => `<img src="${url}">`).join('');
    
    productsDiv.innerHTML+=`<div class="card" style="animation-delay:${idx*50}ms"><div class="img-window" onclick='openImg(${JSON.stringify(imgs)})'><div id="${sid}" class="img-slider">${imgHtml}</div></div><h3>${p.name}</h3><div class="price">â‚¹${p.price}</div><p>${p.description||""}</p><button onclick="addToCart('${p.name}',${p.price})">Add to Cart</button></div>`;
    
    if(imgs.length > 1){ let i=0; setInterval(()=>{ i=(i+1)%imgs.length; const s=document.getElementById(sid); if(s) s.style.transform=`translateX(-${i * 100}%)`; }, 2500); }
  });
  
  setTimeout(initTilt, 500); // Attach 3D effect
});

document.getElementById("searchInput").addEventListener("input",(e)=>{ const v=e.target.value.toLowerCase(); document.querySelectorAll(".card").forEach(c=>{ c.style.display = c.innerText.toLowerCase().includes(v) ? "flex" : "none"; }); });

function addToCart(name,price){ cart.push({name,price}); localStorage.setItem("krochetCart",JSON.stringify(cart)); document.getElementById("cartFloat").classList.add("cart-bump"); setTimeout(()=>document.getElementById("cartFloat").classList.remove("cart-bump"), 300); updateCartUI(); }
function updateCartUI(){ const items=document.getElementById("cartItems"); items.innerHTML=""; currentTotal=0; cart.forEach((p,i)=>{ currentTotal+=p.price; items.innerHTML+=`<div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #eee"><span>${p.name}</span><span>â‚¹${p.price} <b style="color:red;margin-left:10px;cursor:pointer" onclick="removeItem(${i})">âœ–</b></span></div>`; }); document.getElementById("cartCount").innerText=cart.length; document.getElementById("totalPrice").innerText=currentTotal; }
function removeItem(i){ cart.splice(i,1); localStorage.setItem("krochetCart",JSON.stringify(cart)); updateCartUI(); }

/* MODALS */
function openCart(){ openModal('cartModal'); updateCartUI(); }

function openImg(imgs){
  const imgBox = document.getElementById("imgBox");
  const slidesHtml = imgs.map(src => `<img src="${src}">`).join('');
  imgBox.innerHTML = `<div class="popup-slider" id="popupSlider">${slidesHtml}</div>`;
  openModal('imgModal');
  if(imgs.length > 1){
    let i = 0;
    if(popupInterval) clearInterval(popupInterval);
    popupInterval = setInterval(() => {
      i = (i + 1) % imgs.length;
      const slider = document.getElementById("popupSlider");
      if(slider) slider.style.transform = `translateX(-${i * 100}%)`;
    }, 1700);
  }
}
function closeImg(e){ 
  if(e.target.id==="imgModal") {
    closeModal('imgModal');
    if(popupInterval) clearInterval(popupInterval);
  }
}

/* ORDER LOGIC */
function checkLoginForOrder(){ 
  closeModal('cartModal'); 
  const user = firebase.auth().currentUser;
  if(user) {
      const sidebarAddr = document.getElementById("sidebarAddress")?.innerText;
      if(sidebarAddr && !sidebarAddr.includes("No address")) {
          document.getElementById("custAddress").value = sidebarAddr;
      }
      openModal('orderModal');
  } else {
      openModal('authModal');
  }
}

function openPaymentModal(){
  const name=document.getElementById("custName").value.trim();
  const insta=document.getElementById("custInsta").value.trim();
  const addr=document.getElementById("custAddress").value.trim();
  if(!name||!insta||!addr) return alert("Please fill Name, Instagram, and Address.");
  document.getElementById("payAmountDisplay").innerText = currentTotal;
  closeModal('orderModal');
  openModal('paymentAppModal');
}

function launchUPI(appType){
  let link = `upi://pay?pa=${myUPI}&pn=${myName}&am=${currentTotal}&cu=INR`;
  if(appType==='paytm') link = `paytmmp://pay?pa=${myUPI}&pn=${myName}&am=${currentTotal}&cu=INR`;
  if(appType==='phonepe') link = `phonepe://pay?pa=${myUPI}&pn=${myName}&am=${currentTotal}&cu=INR`;
  window.location.href = link;
  closeModal('paymentAppModal');
  setTimeout(()=>{ openModal('confirmCheckModal'); }, 1000);
}

function showQR() {
  closeModal('paymentAppModal');
  const upiUrl = `upi://pay?pa=${myUPI}&pn=${myName}&am=${currentTotal}&cu=INR`;
  const qrApi = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(upiUrl)}`;
  document.getElementById("dynamicQR").src = qrApi;
  document.getElementById("qrAmount").innerText = currentTotal;
  openModal('qrModal');
}

function confirmAndFinishOrder(){
  closeModal('confirmCheckModal');
  closeModal('qrModal'); 
  
  const name=document.getElementById("custName").value.trim();
  const insta=document.getElementById("custInsta").value.trim();
  const addr=document.getElementById("custAddress").value.trim();
  const user = firebase.auth().currentUser;

  db.collection("orders").add({
    customerName: name, instagram: insta, address: addr,
    items: cart, total: currentTotal, status: "Paid via UPI",
    userId: user ? user.uid : "guest", 
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    openModal('orderSuccessModal');
  }).catch((error) => {
    alert("Error: " + error.message);
  });
}

function finishOrderFlow() {
  cart = []; 
  localStorage.removeItem("krochetCart");
  closeModal('orderSuccessModal');
  window.location.href = 'index.html'; 
}

updateCartUI();
</script>

<script src="profile.js"></script>

</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Dashboard | TheKrochet</title>

<!-- EXISTING CSS FILES (PRESERVED) -->
<link rel="stylesheet" href="layout.css">
<link rel="stylesheet" href="responsive.css">

<!-- FONTS -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- ADMIN ONLY POLISH -->
<style>
/* admin only ‚Äì does NOT break layout.css */

.admin-container{
  max-width:900px;
  margin:40px auto;
  padding:0 20px;
}

.card{
  animation:fadeUp .6s ease;
}

@keyframes fadeUp{
  from{opacity:0; transform:translateY(15px)}
  to{opacity:1; transform:translateY(0)}
}

.product-item{
  transition:.3s;
}

.product-item:hover{
  transform:translateY(-3px);
}

/* dark mode safety */
body.dark .product-item,
body.dark .card{
  background:var(--card);
}

/* smoother buttons */
.btn-icon,
.btn-primary{
  transition:.25s;
}
</style>
</head>

<body>

<!-- NAV (UNCHANGED STRUCTURE) -->
<nav>
  <div class="nav-top">
      <h2>TheKrochet Admin</h2>
      <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
  </div>
  <div class="nav-links">
    <a href="index.html" target="_blank">View Live Site ‚Üó</a>
    <button onclick="logout()" class="logout-btn">Logout</button>
  </div>
</nav>

<!-- ADMIN CONTENT -->
<div class="admin-container">

  <!-- FORM CARD -->
  <div class="card">
    <div class="form-header">
      <h3 id="formTitle">Manage Inventory</h3>
      <p class="muted">Add new items or edit existing ones</p>
    </div>

    <div class="form-grid">

      <div>
        <label>Product Name</label>
        <input id="pname" type="text" placeholder="White Crochet Bag">
      </div>

      <div class="form-row-2">
        <div>
          <label>Price (‚Çπ)</label>
          <input id="pprice" type="number">
        </div>
        <div>
          <label>Image URL</label>
          <input id="pimage" type="text">
        </div>
      </div>

      <div>
        <label>Description</label>
        <textarea id="pdesc" rows="3"></textarea>
      </div>

      <button class="btn-primary" id="submitBtn">‚ûï Add Product</button>

    </div>
  </div>

  <!-- LIST CARD -->
  <div class="card">
    <h3>Current Products</h3>
    <div id="productList">
      <p class="muted center">Loading inventory...</p>
    </div>
  </div>

</div>

<!-- FIREBASE (PRESERVED) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- YOUR MAIN JS (PRESERVED) -->
<script src="main.js"></script>

<script>
/* ADMIN LOGIC ONLY ‚Äì SAFE */

const auth = firebase.auth();
const db = firebase.firestore();
let editId = null;

auth.onAuthStateChanged(user=>{
  if(!user) location.href="login.html";
});

function logout(){
  if(confirm("Logout?")){
    auth.signOut().then(()=>location="login.html");
  }
}

const pname = document.getElementById("pname");
const pprice = document.getElementById("pprice");
const pimage = document.getElementById("pimage");
const pdesc = document.getElementById("pdesc");
const submitBtn = document.getElementById("submitBtn");
const formTitle = document.getElementById("formTitle");

submitBtn.onclick = async ()=>{
  if(!pname.value || !pprice.value || !pimage.value){
    alert("Fill required fields");
    return;
  }

  submitBtn.disabled = true;
  submitBtn.innerText = "Processing...";

  const data={
    name:pname.value.trim(),
    price:Number(pprice.value),
    image:pimage.value.trim(),
    description:pdesc.value.trim(),
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  };

  if(editId){
    await db.collection("products").doc(editId).update(data);
    editId=null;
    submitBtn.innerText="‚ûï Add Product";
    formTitle.innerText="Manage Inventory";
  }else{
    await db.collection("products").add(data);
  }

  pname.value=pprice.value=pimage.value=pdesc.value="";
  submitBtn.disabled=false;
};

db.collection("products").orderBy("createdAt","desc")
.onSnapshot(snap=>{
  const list=document.getElementById("productList");
  list.innerHTML="";
  snap.forEach(doc=>{
    const p=doc.data();
    list.innerHTML+=`
      <div class="product-item">
        <div class="p-left">
          <img src="${p.image}" class="p-thumb">
          <div class="p-info">
            <h4>${p.name}</h4>
            <span>‚Çπ${p.price}</span>
          </div>
        </div>
        <div class="actions">
          <button class="btn-icon btn-edit"
            onclick="editProduct('${doc.id}','${p.name}','${p.price}','${p.image}','${p.description||""}')">‚úèÔ∏è</button>
          <button class="btn-icon btn-delete"
            onclick="deleteProduct('${doc.id}')">üóë</button>
        </div>
      </div>`;
  });
});

function editProduct(id,n,pr,img,desc){
  editId=id;
  pname.value=n;
  pprice.value=pr;
  pimage.value=img;
  pdesc.value=desc;
  formTitle.innerText="Editing: "+n;
  submitBtn.innerText="üíæ Save Changes";
  scrollTo({top:0,behavior:"smooth"});
}

function deleteProduct(id){
  if(confirm("Delete product?")){
    db.collection("products").doc(id).delete();
  }
}

/* DARK MODE ‚Äì SAFE */
function toggleTheme(){
  document.body.classList.toggle("dark");
  localStorage.setItem("theme",
    document.body.classList.contains("dark")?"dark":"light");
}

if(localStorage.getItem("theme")==="dark"){
  document.body.classList.add("dark");
}
</script>

</body>
</html>

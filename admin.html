<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<link rel="stylesheet" href="layout.css">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>

<nav>
  <div class="nav-top"><h2>TheKrochet Admin</h2></div>
  <div class="nav-links">
    <a href="index.html" target="_blank">View Site</a>
    <button onclick="logout()" style="background:none; border:none; cursor:pointer;">Logout</button>
  </div>
</nav>

<div style="max-width:600px; margin:30px auto; padding:20px;">
  
  <div class="card" style="margin-bottom:30px;">
    <h3 id="formTitle" style="margin-bottom:15px;">Add Product</h3>
    <input id="pname" placeholder="Product Name">
    <input id="pprice" type="number" placeholder="Price (â‚¹)">
    <input id="pimage" placeholder="Image URL">
    <textarea id="pdesc" placeholder="Description"></textarea>
    <button class="btn-primary" id="submitBtn" style="width:100%">â• Add Product</button>
  </div>

  <div class="card">
    <h3>All Products</h3>
    <div id="productList" style="margin-top:15px;"></div>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="main.js"></script>

<script>
const auth = firebase.auth();
const db = firebase.firestore();
let editId = null;

auth.onAuthStateChanged(user => { if(!user) location.href="login.html"; });
function logout(){ auth.signOut().then(()=>location.href="login.html"); }

const submitBtn = document.getElementById("submitBtn");
const pname = document.getElementById("pname");
const pprice = document.getElementById("pprice");
const pimage = document.getElementById("pimage");
const pdesc = document.getElementById("pdesc");
const formTitle = document.getElementById("formTitle");

submitBtn.onclick = async() => {
  if(!pname.value || !pprice.value) { alert("Enter name & price"); return; }
  const data = {
    name: pname.value.trim(),
    price: Number(pprice.value),
    image: pimage.value.trim(),
    description: pdesc.value.trim(),
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  if(editId){
    await db.collection("products").doc(editId).update(data);
    editId = null;
    submitBtn.innerText = "â• Add Product";
    formTitle.innerText = "Add Product";
  } else {
    await db.collection("products").add(data);
  }
  pname.value=""; pprice.value=""; pimage.value=""; pdesc.value="";
};

db.collection("products").orderBy("createdAt","desc").onSnapshot(snap => {
  const list = document.getElementById("productList");
  list.innerHTML = "";
  snap.forEach(doc => {
    const p = doc.data();
    list.innerHTML += `
      <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:10px 0;">
        <div>
          <strong>${p.name}</strong><br>
          <span style="color:green;">â‚¹${p.price}</span>
        </div>
        <div>
          <button onclick="editProduct('${doc.id}','${p.name}','${p.price}','${p.image}','${p.description||""}')">âœï¸</button>
          <button onclick="if(confirm('Delete?')) db.collection('products').doc('${doc.id}').delete()" style="color:red; margin-left:10px;">ğŸ—‘</button>
        </div>
      </div>`;
  });
});

function editProduct(id,name,price,image,desc){
  editId=id; pname.value=name; pprice.value=price; pimage.value=image; pdesc.value=desc;
  submitBtn.innerText="ğŸ”„ Update"; formTitle.innerText="Update Product";
  window.scrollTo({top:0, behavior:"smooth"});
}
</script>
</body>
</html>

